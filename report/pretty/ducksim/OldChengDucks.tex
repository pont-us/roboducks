% Remember to use the lgrind style

\Head{}
\File{code/ducksim/OldChengDucks.java}{2001}{4}{9}{9:04}{3899}
\L{\LB{\K{package}_\V{ducksim};}}
\L{\LB{}}
\L{\LB{\K{class}_\V{ChengDucks}_\K{extends}_\V{AnimalModel}_\{}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\K{float}_\V{ARENAAREA},_\V{ARENASIZE},_\V{DUCKRADIUS};}}
\L{\LB{}\Tab{2}{\K{float}_\V{K1},_\V{K2},_\V{K3},_\V{K4},_\V{L};}}
\L{\LB{}\Tab{2}{\K{float}_\V{MOMENTUM}_=_\N{0.8f};}}
\L{\LB{}\Tab{2}{\C{}//_*new*_proportion_of_duck{'}s_previous_movement_vector,_rich\CE{}}}
\L{\LB{}\Tab{2}{\K{float}_\V{K5}_=_\N{1000}*\N{1000}/\N{10};_\C{}//_for_duck-duck_attraction_in_new1\CE{}}}
\L{\LB{}\Tab{2}{\K{float}_\V{ATTRACTDIST}_=_\N{1000}/\N{4};_\C{}//_for_duck-duck_attraction_in_new2\CE{}}}
\L{\LB{}\Tab{2}{\K{float}_\V{FLIGHTDIST}_=_\N{1000}/\N{4};_\C{}//_for_duck-herder_repulsion\CE{}}}
\L{\LB{}\Tab{2}{\K{float}_\V{WALLDIST}_=_\V{DUCKRADIUS}_+_\N{15};_\C{}//_for_duck-wall_repulsion\CE{}}}
\L{\LB{}\Tab{2}{\K{float}_\V{SUCCDIST}_=_\N{175};}}
\L{\LB{}\Tab{2}{\C{}//_*change*_this_to_something_proportional_to_no._in_flock\CE{}}}
\L{\LB{}\Tab{2}{\K{float}_\V{DUCKTOPSPEED}_=_\N{4};_\C{}//_a_duck{'}s_top_speed_\CE{}}}
\L{\LB{}\Tab{2}{\K{int}_\V{nFlockRadius};}}
\L{\LB{}\Tab{2}{\V{DuckControl}_\V{state};}}
\L{\LB{}}
\index{ChengDucks}\Proc{ChengDucks}\L{\LB{}\Tab{2}{\V{ChengDucks}(\V{DuckControl}_\V{state})_\{}}
\L{\LB{}\Tab{4}{\K{this}.\V{state}_=_\V{state};}}
\L{\LB{}\Tab{4}{\V{ARENASIZE}_=_\V{state}.\V{arenaSize}();}}
\L{\LB{}\Tab{4}{\V{ARENAAREA}_=_\V{state}.\V{arenaArea}();}}
\L{\LB{}\Tab{4}{\V{K1}_=_\V{ARENAAREA}/\N{10};}}
\L{\LB{}\Tab{4}{\V{K2}_=_\V{ARENAAREA}/\N{100};}}
\L{\LB{}\Tab{4}{\V{K3}_=_\V{ARENAAREA}/\N{100};}}
\L{\LB{}\Tab{4}{\V{K4}_=_\V{ARENAAREA}/\N{1};}\Tab{25}{\C{}//_was_ARENAAREA/10,_rich\CE{}}}
\L{\LB{}\Tab{4}{\C{}//_the_above_were_all_1000*1000/whatever\CE{}}}
\L{\LB{}\Tab{4}{\V{L}_=_\V{ARENASIZE}/\N{6};}\Tab{22}{\C{}//_was_ARENASIZE/4,_rich\CE{}}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\index{update}\Proc{update}\L{\LB{}\Tab{2}{\K{void}_\V{update}()}}
\L{\LB{}\Tab{2}{\{}}
\L{\LB{}\Tab{4}{\V{Vec}_\V{vArenaCentre}_=_\K{new}_\V{Vec}(\N{0},\N{0});}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\K{for}_(\K{int}_\V{i}_=_\N{0};_\V{i}\<\V{state}.\V{ducks}();_\V{i}++)_\{}}
\L{\LB{}\Tab{6}{\V{Vec}_\V{totforce},_\V{wallpt},_\V{duckpos};}}
\L{\LB{}\Tab{6}{\K{float}_\V{dist},_\V{force};}}
\L{\LB{}\Tab{6}{\V{duckpos}_=_\V{state}.\V{duckPos}(\V{i});}}
\L{\LB{}\Tab{6}{\V{totforce}_=_\K{new}_\V{Vec}(\N{0},\N{0});}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\C{}//_*new*_duck_attraction_instinct_2_(limited_range_attraction)\CE{}}}
\L{\LB{}\Tab{6}{\K{for}_(\K{int}_\V{j}_=_\N{0};_\V{j}_\<_\V{state}.\V{ducks}();_\V{j}++)_\{}}
\L{\LB{}\Tab{8}{\K{if}_(\V{j}_==_\V{i})_\K{continue};}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\V{Vec}_\V{otherduckpos}_=_\V{state}.\V{duckPos}(\V{j});}}
\L{\LB{}\Tab{8}{\K{float}_\V{attforce},_\V{repforce};}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\V{dist}_=_\V{otherduckpos}.\V{mi}(\V{duckpos}).\V{abs}();}}
\L{\LB{}\Tab{8}{\V{attforce}_=}\Tab{21}{\V{K1}_/_((\V{dist}_+_\V{L})_*_(\V{dist}_+_\V{L}));}}
\L{\LB{}\Tab{8}{\V{repforce}_=_\-_\V{K2}_/_(\V{dist}_*_\V{dist});}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\V{attforce}_\-=}\Tab{22}{\V{K1}_/_((\V{ATTRACTDIST}_+_\V{L})_*_(\V{ATTRACTDIST}_+_\V{L}));}}
\L{\LB{}\Tab{8}{\V{repforce}_\-=_\-_\V{K2}_/_(\V{ATTRACTDIST}_*_\V{ATTRACTDIST});_}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{if}_(\V{attforce}_\<_\N{0.0})_\V{attforce}_=_\N{0.0f};}}
\L{\LB{}\Tab{8}{\K{if}_(\V{repforce}_\>_\N{0.0})_\V{repforce}_=_\N{0.0f};}}
\L{\LB{}\Tab{8}{\V{force}_=_\V{attforce}_+_\V{repforce};}}
\L{\LB{}\Tab{8}{\V{totforce}.\V{pleq}(_\V{otherduckpos}.\V{mi}(\V{duckpos}).\V{unit}().\V{ti}(\V{force})_);}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{wallpt}_=_\V{duckpos}.\V{mi}(\V{vArenaCentre}).\V{unit}().}}
\L{\LB{}\Tab{8}{\V{ti}(\V{ARENASIZE}/\N{2}).\V{pl}(\V{vArenaCentre});}}
\L{\LB{}\Tab{6}{\V{dist}_=_\V{wallpt}.\V{mi}(\V{duckpos}).\V{abs}();}}
\L{\LB{}\Tab{6}{\V{force}_=_\-_\V{K3}_/_(\V{dist}_*_\V{dist});}}
\L{\LB{}\Tab{6}{\V{force}_\-=_\-_\V{K3}_/_(\V{WALLDIST}_*_\V{WALLDIST});}}
\L{\LB{}\Tab{6}{\K{if}_(\V{force}_\>_\N{0})_\V{force}_=_\N{0.0f};}}
\L{\LB{}\Tab{6}{\V{totforce}.\V{pleq}(_\V{wallpt}.\V{mi}(\V{duckpos}).\V{unit}().\V{ti}(\V{force})_);}}
\L{\LB{}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\C{}//_*new*_herder_repulsion_instinct\CE{}}}
\L{\LB{}\Tab{6}{\K{for}_(\K{int}_\V{j}_=_\N{0};_\V{j}_\<_\V{state}.\V{dogs}();_\V{j}++)_\{}}
\L{\LB{}\Tab{8}{\V{Vec}_\V{herderpos}_=_\V{state}.\V{dogPos}(\V{j});}}
\L{\LB{}\Tab{8}{\V{dist}_=_\V{herderpos}.\V{mi}(\V{duckpos}).\V{abs}();}}
\L{\LB{}\Tab{8}{\V{force}_=_\-_\V{K4}_/_(\V{dist}_*_\V{dist});}}
\L{\LB{}\Tab{8}{\V{force}_\-=_\-_\V{K4}_/_(\V{FLIGHTDIST}_*_\V{FLIGHTDIST});}}
\L{\LB{}\Tab{8}{\K{if}_(\V{force}_\>_\N{0.0})_\V{force}_=_\N{0.0f};}}
\L{\LB{}\Tab{8}{\V{totforce}.\V{pleq}(\V{herderpos}.\V{mi}(\V{duckpos}).\V{unit}().\V{ti}(\V{force}));}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{state}.\V{setDuck}(\V{i},_\V{state}.\V{duck}(\V{i}).\V{d}.\V{ti}(\V{MOMENTUM}).\V{pl}(\V{totforce}.\V{ti}(\N{1}\-\V{MOMENTUM})));}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\C{}//_duck_speed_limiter\CE{}}}
\L{\LB{}\Tab{6}{\C{}//_WHAT_THE_YELLOW_RUBBERY_FUCK?!_He{'}s_taking_the\CE{}}}
\L{\LB{}\Tab{6}{\C{}//_abs_of_a_unit_vector.\,.\,._the_man{'}s_a_maniac\CE{}}}
\L{\LB{}\Tab{6}{\K{if}_(\V{state}.\V{duck}(\V{i}).\V{d}.\V{abs}()_\>_\N{3.5})}}
\L{\LB{}\Tab{8}{\V{state}.\V{setDuck}(\V{i},_\V{state}.\V{duck}(\V{i}).\V{d}.\V{ti}((\K{float})_(\N{1}/\N{3.5})));}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\C{}//}\Tab{10}{richie{'}s_duck_wall_avoidance_code.\CE{}}}
\L{\LB{}\Tab{6}{\V{Vec}_\V{endpt}_=_\V{state}.\V{duck}(\V{i}).\V{p}.\V{pl}(\V{state}.\V{duck}(\V{i}).\V{d});}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{wallpt}_=_}}
\L{\LB{}\Tab{10}{\V{endpt}.\V{mi}(\V{vArenaCentre}).\V{unit}().\V{ti}(\V{ARENASIZE}/\N{2}\-\N{5}).\V{pl}(\V{vArenaCentre});}}
\L{\LB{}\Tab{6}{\K{if}_(\V{endpt}.\V{mi}(\V{vArenaCentre}).\V{abs}()_\>_\V{ARENASIZE}/\N{2}_\-_\N{2})}}
\L{\LB{}\Tab{8}{\V{state}.\V{setDuck}(\V{i},_\V{state}.\V{duck}(\V{i}).\V{d}.\V{mi}(\V{endpt}.\V{mi}(\V{wallpt}).\V{ti}(\N{0.01f})));}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\C{}//_Matt{'}s_updated_angle_code_in_floats_and_radians\CE{}}}
\L{\LB{}\Tab{6}{\C{}//_scope_for_optimisation_here_but_not_going_into_it_yet\CE{}}}
\L{\LB{}\Tab{6}{\K{float}_\V{theta}_=_(\K{float})_\V{Math}.\V{atan}(\V{totforce}.\V{x}_/\V{totforce}.\V{y});}}
\L{\LB{}\Tab{8}{\C{}//_note_sign_change!!\CE{}}}
\L{\LB{}\Tab{6}{\K{if}_(\V{totforce}.\V{x}_\>_\N{0}_\&\&_\V{totforce}.\V{y}_\>\N{0})_}}
\L{\LB{}\Tab{8}{\{_\V{state}.\V{duck}(\V{i}).\V{nAngle}_=_\V{theta};\}}}
\L{\LB{}\Tab{6}{\K{else}_\K{if}_(\V{totforce}.\V{x}_\>_\N{0}_\&\&_\V{totforce}.\V{y}_\<_\N{0})_}}
\L{\LB{}\Tab{8}{\{_\V{state}.\V{duck}(\V{i}).\V{nAngle}_=_(\K{float})_\V{Math}.\V{PI}_+_\V{theta};\}}}
\L{\LB{}\Tab{6}{\K{else}_\K{if}_(\V{totforce}.\V{x}_\<_\N{0}_\&\&_\V{totforce}.\V{y}_\<_\N{0})_}}
\L{\LB{}\Tab{8}{\{_\V{state}.\V{duck}(\V{i}).\V{nAngle}_=_(\K{float})_\V{Math}.\V{PI}_+_\V{theta};\}}}
\L{\LB{}\Tab{6}{\K{else}_\K{if}_(\V{totforce}.\V{x}_\<_\N{0}_\&\&_\V{totforce}.\V{y}_\>_\N{0})}}
\L{\LB{}\Tab{8}{\{_\V{state}.\V{duck}(\V{i}).\V{nAngle}_=_(\K{float})_\V{Math}.\V{PI}*\N{2}_+_\V{theta};\}}}
\L{\LB{}\Tab{6}{\K{else}_\K{if}_(\V{totforce}.\V{x}_==_\N{0})}}
\L{\LB{}\Tab{8}{\K{if}_(\V{totforce}.\V{y}_\>=_\N{0})_\{_\V{state}.\V{duck}(\V{i}).\V{nAngle}_=_\N{0.0f};\}}}
\L{\LB{}\Tab{8}{\K{else}_\{_\V{state}.\V{duck}(\V{i}).\V{nAngle}_=_(\K{float})_\V{Math}.\V{PI};\}}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\C{}//_Apply_velocities._Oh_no_we_don{'}t.\CE{}}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\index{postUpdate}\Proc{postUpdate}\L{\LB{}\Tab{2}{\K{void}_\V{postUpdate}()_\{\}_}}
\L{\LB{\}}}
