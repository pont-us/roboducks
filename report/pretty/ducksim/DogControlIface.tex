% Remember to use the lgrind style

\Head{}
\File{code/ducksim/DogControlIface.java}{2001}{5}{18}{8:56}{1855}
\L{\LB{\C{}//_DogControlIface\CE{}}}
\L{\LB{}}
\L{\LB{\C{}//_a_class_to_interface_neural_network_inputs_and_outputs_to\CE{}}}
\L{\LB{\C{}//_the_DogControl_interface\CE{}}}
\L{\LB{}}
\L{\LB{\K{package}_\V{ducksim};}}
\L{\LB{\K{import}_\V{neurotic}.*;}}
\L{\LB{}}
\L{\LB{\K{class}_\V{DogControlIface}_\K{implements}_\V{DogBreeder}.\V{ControlInterface}_\{}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\V{DogControl}_\V{dogCont};}}
\L{\LB{}\Tab{2}{\V{TrainerControl}_\V{trainCont};}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{PI}_=_(\K{float})_\V{Math}.\V{PI};}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{int}_\V{inputs}_=_\N{5};_\C{}//_\#_input_nodes\CE{}}}
\L{\LB{}}
\index{DogControlIface}\Proc{DogControlIface}\L{\LB{}\Tab{2}{\V{DogControlIface}(\V{DogControl}_\V{dogCont},_\V{TrainerControl}_\V{trainCont})_\{}}
\L{\LB{}\Tab{4}{\K{this}.\V{dogCont}_=_\V{dogCont};}}
\L{\LB{}\Tab{4}{\K{this}.\V{trainCont}_=_\V{trainCont};}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\index{inputs}\Proc{inputs}\L{\LB{}\Tab{2}{\K{public}_\K{int}_\V{inputs}()_\{_\K{return}_\V{inputs};_\}}}
\L{\LB{}}
\index{update}\Proc{update}\L{\LB{}\Tab{2}{\K{public}_\K{void}_\V{update}(\V{Net}_\V{net},_\V{DogControl}_\V{control})_\{}}
\L{\LB{}\Tab{4}{\V{Pos}_\V{dogPos}_=_\V{control}.\V{dog}(\N{0});}}
\L{\LB{}\Tab{4}{\V{Vec}_\V{wall}_=_\V{wallPoint}(\V{dogPos}.\V{p});_\C{}//_nearest_wall_point\CE{}}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\V{net}.\V{setIn}(\N{0},_\V{normAngle}(\V{wall}.\V{angle}()_\-_\V{dogPos}.\V{d}.\V{angle}()));}}
\L{\LB{}\Tab{4}{\C{}//_Angle_to_nearest_wall_point\CE{}}}
\L{\LB{}\Tab{4}{\V{net}.\V{setIn}(\N{1},_\V{dogPos}.\V{p}.\V{distTo}(\V{wall})_/_\V{control}.\V{arenaSize}());}}
\L{\LB{}\Tab{4}{\C{}//_distance_to_nearest_wall_point\CE{}}}
\L{\LB{}\Tab{4}{\V{net}.\V{setIn}(\N{2},_\V{normAngle}(_\V{dogPos}.\V{p}.\V{angleTo}(\V{control}.\V{flockCentre}())}}
\L{\LB{}\Tab{28}{\-_\V{dogPos}.\V{d}.\V{angle}()));}}
\L{\LB{}\Tab{4}{\C{}//_angle_to_flock_centre\CE{}}}
\L{\LB{}\Tab{4}{\V{net}.\V{setIn}(\N{3},_\V{dogPos}.\V{p}.\V{distTo}(\V{control}.\V{flockCentre}())_/}}
\L{\LB{}\Tab{14}{\V{control}.\V{arenaSize}());}}
\L{\LB{}\Tab{4}{\C{}//_distance_to_flock_centre\CE{}}}
\L{\LB{}\Tab{4}{\V{net}.\V{setIn}(\N{4},_\N{2}_*_\V{control}.\V{flockRadius}()_/_\V{control}.\V{arenaSize}());}}
\L{\LB{}\Tab{4}{\C{}//_size_of_flock\CE{}}}
\L{\LB{}\Tab{4}{\V{net}.\V{think}();}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\K{float}_\V{theta}_=_\V{dogPos}.\V{d}.\V{angle}();}}
\L{\LB{}\Tab{4}{\K{float}_\V{r}_=_\V{dogPos}.\V{d}.\V{abs}();}}
\L{\LB{}\Tab{4}{\V{r}_=_\V{net}.\V{getOut}(\N{0})_*_\N{16};}}
\L{\LB{}\Tab{4}{\V{theta}_+=_\N{0.9}_*_(\V{net}.\V{getOut}(\N{1})_\-_\N{0.5f});_\C{}//_*_PI\CE{}}}
\L{\LB{}\Tab{4}{\V{dogPos}.\V{d}.\V{x}_=_(\K{float})_(\V{r}_*_\V{Math}.\V{sin}(\V{theta}));}}
\L{\LB{}\Tab{4}{\V{dogPos}.\V{d}.\V{y}_=_(\K{float})_(\V{r}_*_\V{Math}.\V{cos}(\V{theta}));}}
\L{\LB{}\Tab{4}{\V{control}.\V{setDog}(\N{0},_\V{dogPos}.\V{d});}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\C{}//_map_angle_in_radians_onto_[0,1]\CE{}}}
\L{\LB{}\Tab{2}{\C{}//_-pi_\|-\!\>_0,_+pi_\|-\!\>_1,_values_outside_[-pi,pi]_wrap.\CE{}}}
\index{normAngle}\Proc{normAngle}\L{\LB{}\Tab{2}{\K{private}_\K{float}_\V{normAngle}(\K{float}_\V{theta})_\{}}
\L{\LB{}\Tab{4}{\K{float}_\V{out}_=_(_(\V{theta}_+_\V{PI})_/_(\N{2}*\V{PI})_)_\%_\N{1.0f};}}
\L{\LB{}\Tab{4}{\K{if}_(\V{out}\<\N{0})_\V{out}_+=_\N{1.0f};}}
\L{\LB{}\Tab{4}{\K{return}_\V{out};}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\C{}//_find_nearest_point_on_arena_wall\CE{}}}
\index{wallPoint}\Proc{wallPoint}\L{\LB{}\Tab{2}{\V{Vec}_\V{wallPoint}(\V{Vec}_\V{v})_\{}}
\L{\LB{}\Tab{4}{\K{return}_\V{v}.\V{unit}().\V{ti}(\V{trainCont}.\V{arenaSize}()).\V{mi}(\V{v});}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\L{\LB{\}}}
