% Remember to use the lgrind style

\Head{}
\File{code/ducksim/ChengDucks.java}{2001}{5}{16}{10:50}{3607}
\L{\LB{\C{}/*_ChengDucks:_the_duck_model,_developed_by_Richard_Cheng}}
\L{\LB{}\Tab{3}{last_year_from_Richard_Vaughan{'}s_original_algorithm,_now_translated}}
\L{\LB{}\Tab{3}{from_C++_to_Java_and_tidied_up_for_this_project._*/\CE{}}}
\L{\LB{}}
\L{\LB{\K{package}_\V{ducksim};}}
\L{\LB{}}
\L{\LB{\K{class}_\V{ChengDucks}_\K{extends}_\V{AnimalModel}_\{}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\C{}/*_NB:_The_arena_radius_is_hardwired_to_1000._There{'}s_not_really}}
\L{\LB{}\Tab{5}{any_reason_to_change_this_for_the_purposes_of_this_project,_so}}
\L{\LB{}\Tab{5}{it_makes_sense_to_use_final_statics_and_gain_some_extra_speed._*/\CE{}}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{ARENASIZE}_=_\N{1000};}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{ARENAAREA}_=_\V{ARENASIZE}_*_\V{ARENASIZE};}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{DUCKRADIUS}_=_\V{ARENASIZE}_/_\N{22};}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{K1}_=_\V{ARENAAREA}/\N{10};}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{K2}_=_\V{ARENAAREA}/\N{100};}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{K3}_=_\V{ARENAAREA}/\N{100};}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{K4}_=_\V{ARENAAREA}/\N{1};}\Tab{42}{\C{}//_was_ARENAAREA/10,_rich\CE{}}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{L}_=_\V{ARENASIZE}/\N{6};}\Tab{39}{\C{}//_was_ARENASIZE/4,_rich\CE{}}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{WALLDIST}_=_\V{DUCKRADIUS}_+_\N{15};_}}
\L{\LB{}\Tab{2}{\C{}//_for_duck-wall_repulsion\CE{}}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{MOMENTUM}_=_\N{0.8f};}}
\L{\LB{}\Tab{2}{\C{}//_*new*_proportion_of_duck{'}s_previous_movement_vector,_rich\CE{}}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{K5}_=_\N{1000}*\N{1000}/\N{10};}}
\L{\LB{}\Tab{2}{\C{}//_for_duck-duck_attraction_in_new1\CE{}}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{ATTRACTDIST}_=_\N{1000}/\N{4};}}
\L{\LB{}\Tab{2}{\C{}//_for_duck-duck_attraction_in_new2\CE{}}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{FLIGHTDIST}_=_\N{1000}/\N{4};}}
\L{\LB{}\Tab{2}{\C{}//_for_duck-herder_repulsion\CE{}}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{SUCCDIST}_=_\N{175};}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{DUCKTOPSPEED}_=_\N{4};_\C{}//_a_duck{'}s_top_speed_\CE{}}}
\L{\LB{}\Tab{2}{\K{int}_\V{nFlockRadius};}}
\L{\LB{}\Tab{2}{\V{DuckControl}_\V{state};}}
\L{\LB{}}
\index{ChengDucks}\Proc{ChengDucks}\L{\LB{}\Tab{2}{\V{ChengDucks}(\V{DuckControl}_\V{state})_\{}}
\L{\LB{}\Tab{4}{\K{this}.\V{state}_=_\V{state};}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\index{update}\Proc{update}\L{\LB{}\Tab{2}{\K{void}_\V{update}()}}
\L{\LB{}\Tab{2}{\{}}
\L{\LB{}\Tab{4}{\C{}//_Vec_vArenaCentre_=_new_Vec(0,0);\CE{}}}
\L{\LB{}\Tab{4}{\C{}//_We_can_ignore_this_since_it{'}s_zero;_speed_is_more_important\CE{}}}
\L{\LB{}\Tab{4}{\C{}//_for_now.\CE{}}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\V{Vec}_\V{totforce},_\V{wallpt},_\V{duckpos},_\V{otherduckpos},_\V{herderpos},_\V{duckV},_\V{endpt};}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\K{for}_(\K{int}_\V{i}_=_\N{0};_\V{i}\<\V{state}.\V{ducks}();_\V{i}++)_\{}}
\L{\LB{}\Tab{6}{\K{float}_\V{dist},_\V{force};}}
\L{\LB{}\Tab{6}{\V{duckpos}_=_\V{state}.\V{duckPos}(\V{i});}}
\L{\LB{}\Tab{6}{\V{totforce}_=_\K{new}_\V{Vec}(\N{0},\N{0});}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\C{}//_*new*_duck_attraction_instinct_2_(limited_range_attraction)\CE{}}}
\L{\LB{}\Tab{6}{\K{for}_(\K{int}_\V{j}_=_\N{0};_\V{j}_\<_\V{state}.\V{ducks}();_\V{j}++)_\{}}
\L{\LB{}\Tab{8}{\K{if}_(\V{j}_==_\V{i})_\K{continue};}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\V{otherduckpos}_=_\V{state}.\V{duckPos}(\V{j});}}
\L{\LB{}\Tab{8}{\K{float}_\V{attforce},_\V{repforce};}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\V{dist}_=_\V{otherduckpos}.\V{mi}(\V{duckpos}).\V{abs}();}}
\L{\LB{}\Tab{8}{\V{attforce}_=}\Tab{21}{\V{K1}_/_((\V{dist}_+_\V{L})_*_(\V{dist}_+_\V{L}));}}
\L{\LB{}\Tab{8}{\V{repforce}_=_\-_\V{K2}_/_(\V{dist}_*_\V{dist});}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\V{attforce}_\-=}\Tab{22}{\V{K1}_/_((\V{ATTRACTDIST}_+_\V{L})_*_(\V{ATTRACTDIST}_+_\V{L}));}}
\L{\LB{}\Tab{8}{\V{repforce}_\-=_\-_\V{K2}_/_(\V{ATTRACTDIST}_*_\V{ATTRACTDIST});_}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{if}_(\V{attforce}_\<_\N{0.0})_\V{attforce}_=_\N{0.0f};}}
\L{\LB{}\Tab{8}{\K{if}_(\V{repforce}_\>_\N{0.0})_\V{repforce}_=_\N{0.0f};}}
\L{\LB{}\Tab{8}{\V{force}_=_\V{attforce}_+_\V{repforce};}}
\L{\LB{}\Tab{8}{\V{totforce}.\V{pleq}(_\V{otherduckpos}.\V{mi}(\V{duckpos}).\V{unit}().\V{ti}(\V{force})_);}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{wallpt}_=_\V{duckpos}.\V{unit}().\V{ti}(\V{ARENASIZE});}}
\L{\LB{}\Tab{6}{\V{dist}_=_\V{wallpt}.\V{distTo}(\V{duckpos});}}
\L{\LB{}\Tab{6}{\V{force}_=_\-_\V{K3}_/_(\V{dist}_*_\V{dist});}}
\L{\LB{}\Tab{6}{\V{force}_\-=_\-_\V{K3}_/_(\V{WALLDIST}_*_\V{WALLDIST});}}
\L{\LB{}\Tab{6}{\K{if}_(\V{force}_\>_\N{0})_\V{force}_=_\N{0.0f};}}
\L{\LB{}\Tab{6}{\V{totforce}.\V{pleq}(_\V{duckpos}.\V{dirTo}(\V{wallpt}).\V{ti}(\V{force})_);}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\C{}//_*new*_herder_repulsion_instinct\CE{}}}
\L{\LB{}\Tab{6}{\K{for}_(\K{int}_\V{j}_=_\N{0};_\V{j}_\<_\V{state}.\V{dogs}();_\V{j}++)_\{}}
\L{\LB{}\Tab{8}{\V{herderpos}_=_\V{state}.\V{dogPos}(\V{j});}}
\L{\LB{}\Tab{8}{\V{dist}_=_\V{herderpos}.\V{distTo}(\V{duckpos});}}
\L{\LB{}\Tab{8}{\V{force}_=_\-_\V{K4}_/_(\V{dist}_*_\V{dist});}}
\L{\LB{}\Tab{8}{\V{force}_\-=_\-_\V{K4}_/_(\V{FLIGHTDIST}_*_\V{FLIGHTDIST});}}
\L{\LB{}\Tab{8}{\K{if}_(\V{force}_\>_\N{0.0})_\V{force}_=_\N{0.0f};}}
\L{\LB{}\Tab{8}{\V{totforce}.\V{pleq}(\V{duckpos}.\V{dirTo}(\V{herderpos}).\V{ti}(\V{force}));}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{duckV}_=_\V{state}.\V{duck}(\V{i}).\V{d}.\V{ti}(\V{MOMENTUM}).}}
\L{\LB{}\Tab{10}{\V{pl}(\V{totforce}.\V{ti}(\N{1}\-\V{MOMENTUM}));}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\C{}//_state.setDuck(i,state.duck(i).d.ti(MOMENTUM).\CE{}}}
\L{\LB{}\Tab{6}{\C{}//}\Tab{20}{pl(totforce.ti(1-MOMENTUM)));\CE{}}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\C{}//_duck_speed_limiter\CE{}}}
\L{\LB{}\Tab{6}{\C{}//_if_(duckV.abs()_\>_3.5f)_duckV.dieq(3.5f);\CE{}}}
\L{\LB{}\Tab{6}{\K{if}_(\V{duckV}.\V{abs}()_\>_\N{3.5f})_\V{duckV}.\V{tieq}(\N{3.0f}_/_\V{duckV}.\V{abs}());}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\C{}//}\Tab{10}{richie{'}s_duck_wall_avoidance_code.\CE{}}}
\L{\LB{}\Tab{6}{\V{endpt}_=_\V{duckpos}.\V{pl}(\V{duckV});}}
\L{\LB{}\Tab{6}{\K{if}_(\V{endpt}.\V{abs}()_\>_\V{ARENASIZE}/\N{2}_\-_\N{2})_\{}}
\L{\LB{}\Tab{8}{\V{wallpt}_=_\V{endpt}.\V{unit}().\V{ti}(\V{ARENASIZE}/\N{2}\-\N{5});}}
\L{\LB{}\Tab{8}{\V{duckV}.\V{mieq}(_\V{endpt}.\V{mi}(\V{wallpt}).\V{ti}(\N{0.01f})_);}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}\Tab{6}{\V{state}.\V{setDuck}(\V{i},_\V{duckV});}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\index{postUpdate}\Proc{postUpdate}\L{\LB{}\Tab{2}{\K{void}_\V{postUpdate}()_\{\}_}}
\L{\LB{\}}}
