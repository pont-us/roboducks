% Remember to use the lgrind style

\Head{}
\File{code/ducksim/OrigDog.java}{2001}{3}{28}{16:05}{2681}
\L{\LB{\K{package}_\V{ducksim};}}
\L{\LB{}}
\L{\LB{\K{public}_\K{class}_\V{OrigDog}_\K{extends}_\V{AnimalModel}_\{}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\K{float}_\V{ARENASIZE},_\V{ARENAAREA},_\V{HERDERK1},_\V{HERDERK2};}}
\L{\LB{}\Tab{4}{\K{int}_\V{nFlockRadius};}}
\L{\LB{}\Tab{4}{\V{DogControl}_\V{state};}}
\L{\LB{}\Tab{4}{\V{Vec}_\V{G};}}
\L{\LB{}}
\index{OrigDog}\Proc{OrigDog}\L{\LB{}\Tab{4}{\V{OrigDog}(\V{DogControl}_\V{state},_\V{Vec}_\V{goal})_\{}}
\L{\LB{}\Tab{8}{\K{this}.\V{state}_=_\V{state};}}
\L{\LB{}\Tab{8}{\K{this}.\V{ARENASIZE}_=_\V{state}.\V{arenaSize}();}}
\L{\LB{}\Tab{8}{\V{ARENAAREA}_=_\V{ARENASIZE}_*_\V{ARENASIZE};}}
\L{\LB{}\Tab{8}{\V{HERDERK1}_=_\N{0.0005f};}}
\L{\LB{}\Tab{8}{\V{HERDERK2}_=_\N{0.9f};}}
\L{\LB{}\Tab{8}{\V{G}_=_\V{goal};}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}}
\index{update}\Proc{update}\L{\LB{}\Tab{4}{\K{void}_\V{update}()_\{}}
\L{\LB{}\Tab{8}{\C{}//_Vec_vArenaCentre_=_new_Vec(ARENASIZE/2,_ARENASIZE/2);\CE{}}}
\L{\LB{}\Tab{8}{\V{Vec}_\V{vArenaCentre}_=_\K{new}_\V{Vec}(\N{0},\N{0});}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\C{}//_Calculate_flock_centre}\Tab{37}{\CE{}}}
\L{\LB{}\Tab{8}{\V{Vec}_\V{F}_=_\K{new}_\V{Vec}(\N{0},\N{0});}}
\L{\LB{}\Tab{8}{\K{for}_(\K{int}_\V{i}_=_\N{0};_\V{i}_\<_\V{state}.\V{ducks}();_\V{i}++)}}
\L{\LB{}\Tab{12}{\V{F}_=_\V{F}.\V{pl}(\V{state}.\V{duck}(\V{i}).\V{p});}}
\L{\LB{}\Tab{8}{\V{F}_=_\V{F}.\V{ti}(\N{1}/\V{state}.\V{ducks}());}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{for}_(\K{int}_\V{i}_=_\N{0};_\V{i}_\<_\V{state}.\V{dogs}();_\V{i}++)_\{}}
\L{\LB{}\Tab{12}{\C{}//_Apply_herder_control_algorithm\CE{}}}
\L{\LB{}\Tab{12}{\V{Vec}_\V{R}_=_\K{new}_\V{Vec}(\V{state}.\V{dog}(\V{i}).\V{p}.\V{x},_\V{state}.\V{dog}(\V{i}).\V{p}.\V{y});}}
\L{\LB{}\Tab{12}{\V{Vec}_\V{r}_=_\K{new}_\V{Vec}(\N{0},\N{0});}}
\L{\LB{}}
\L{\LB{}\Tab{12}{\V{r}_=_\V{F}.\V{mi}(\V{R}).\V{unit}().\V{ti}(\V{F}.\V{mi}(\V{G}).\V{abs}()).\V{ti}(\V{HERDERK1}).}}
\L{\LB{}\Tab{16}{\V{mi}(\V{G}.\V{mi}(\V{R}).\V{unit}().\V{ti}(\V{HERDERK2}));}}
\L{\LB{}\Tab{16}{}}
\L{\LB{}\Tab{12}{\C{}//_Matt{'}s_updated_angle_code_in_floats_and_radiansz2\CE{}}}
\L{\LB{}\Tab{12}{\C{}//_scope_for_optimisation_here_but_not_going_into_it_yet\CE{}}}
\L{\LB{}\Tab{10}{}}
\L{\LB{}\Tab{12}{\K{float}_\V{theta}_=_(\K{float})_\V{Math}.\V{atan}(\V{r}.\V{x}_/\V{r}.\V{y});_\C{}//_note_sign_change!!\CE{}}}
\L{\LB{}\Tab{12}{\K{if}_(\V{r}.\V{x}_\>_\N{0}_\&\&_\V{r}.\V{y}_\>\N{0})_}}
\L{\LB{}\Tab{16}{\{_\V{state}.\V{dog}(\V{i}).\V{nAngle}_=_\V{theta};\}}}
\L{\LB{}\Tab{12}{\K{else}_\K{if}_(\V{r}.\V{x}_\>_\N{0}_\&\&_\V{r}.\V{y}_\<_\N{0})_}}
\L{\LB{}\Tab{16}{\{_\V{state}.\V{dog}(\V{i}).\V{nAngle}_=_(\K{float})_\V{Math}.\V{PI}_+_\V{theta};\}}}
\L{\LB{}\Tab{12}{\K{else}_\K{if}_(\V{r}.\V{x}_\<_\N{0}_\&\&_\V{r}.\V{y}_\<_\N{0})_}}
\L{\LB{}\Tab{16}{\{_\V{state}.\V{dog}(\V{i}).\V{nAngle}_=_(\K{float})_\V{Math}.\V{PI}_+_\V{theta};\}}}
\L{\LB{}\Tab{12}{\K{else}_\K{if}_(\V{r}.\V{x}_\<_\N{0}_\&\&_\V{r}.\V{y}_\>_\N{0})}}
\L{\LB{}\Tab{16}{\{_\V{state}.\V{dog}(\V{i}).\V{nAngle}_=_(\K{float})_\V{Math}.\V{PI}*\N{2}_+_\V{theta};\}}}
\L{\LB{}\Tab{12}{\K{else}_\K{if}_(\V{r}.\V{x}_==_\N{0})}}
\L{\LB{}\Tab{16}{\K{if}_(\V{r}.\V{y}_\>=_\N{0})_\{_\V{state}.\V{dog}(\V{i}).\V{nAngle}_=_\N{0.0f};\}}}
\L{\LB{}\Tab{12}{\C{}//_the_above_referred_to_the_ducks_in_the_original_code\CE{}}}
\L{\LB{}\Tab{12}{\C{}//_I_assume_that_was_a_typo.\,.\,.\CE{}}}
\L{\LB{}\Tab{16}{\K{else}_\{_\V{state}.\V{dog}(\V{i}).\V{nAngle}_=_(\K{float})_\V{Math}.\V{PI};\}}}
\L{\LB{}\Tab{10}{}}
\L{\LB{}\Tab{12}{\V{state}.\V{setDog}(\V{i},\V{r});}}
\L{\LB{}\Tab{16}{}}
\L{\LB{}\Tab{12}{\K{boolean}_\V{close};}}
\L{\LB{}\Tab{12}{\C{}//Matt{'}s_wall_check_code_-_CRUDE!!\CE{}}}
\L{\LB{}\Tab{12}{\K{float}_\V{a}_=_\V{state}.\V{dog}(\V{i}).\V{p}.\V{x}_\-_\V{ARENASIZE}/\N{2};}}
\L{\LB{}\Tab{12}{\K{float}_\V{b}_=_\V{state}.\V{dog}(\V{i}).\V{p}.\V{y}_\-_\V{ARENASIZE}/\N{2};}}
\L{\LB{}\Tab{12}{\K{float}_\V{walldist}_=_\V{ARENASIZE}/\N{2}_\-_(\K{float})_\V{Math}.\V{sqrt}(\V{a}*\V{a}+\V{b}*\V{b});}}
\L{\LB{}\Tab{12}{\K{final}_\K{float}_\V{mul}_=_\V{walldist}/\V{ARENASIZE}/\N{16};}}
\L{\LB{}\Tab{12}{\K{if}_(\V{walldist}_\<_\V{ARENASIZE}/\N{16})_}}
\L{\LB{}\Tab{16}{\{_\V{close}_=_\K{true};\}_\K{else}_\{\V{close}_=_\K{false};\}}}
\L{\LB{}\Tab{10}{}}
\L{\LB{}\Tab{12}{\K{if}_(\V{close})_\{}}
\L{\LB{}\Tab{16}{\K{if}_(\V{a}_\>=_\N{0.0f}_\&\&_\V{b}_\>=_\N{0.0f})_\{_}}
\L{\LB{}\Tab{20}{\K{if}_(\V{state}.\V{dog}(\V{i}).\V{d}.\V{x}_\>_\N{0})_\{\V{state}.\V{dog}(\V{i}).\V{d}.\V{x}_*=_\V{mul};\}}}
\L{\LB{}\Tab{20}{\K{if}_(\V{state}.\V{dog}(\V{i}).\V{d}.\V{y}_\>_\N{0})_\{\V{state}.\V{dog}(\V{i}).\V{d}.\V{y}_*=_\V{mul};\}_\}}}
\L{\LB{}\Tab{16}{\K{if}_(\V{a}_\>=_\N{0.0f}_\&\&_\V{b}_\<=_\N{0.0f})_\{_}}
\L{\LB{}\Tab{20}{\K{if}_(\V{state}.\V{dog}(\V{i}).\V{d}.\V{x}_\>_\N{0})_\{\V{state}.\V{dog}(\V{i}).\V{d}.\V{x}_*=_\V{mul};\}}}
\L{\LB{}\Tab{20}{\K{if}_(\V{state}.\V{dog}(\V{i}).\V{d}.\V{y}_\<_\N{0})_\{\V{state}.\V{dog}(\V{i}).\V{d}.\V{y}_*=_\V{mul};\}_\}}}
\L{\LB{}\Tab{16}{\K{if}_(\V{a}_\<=_\N{0.0f}_\&\&_\V{b}_\<=_\N{0.0f})_\{_}}
\L{\LB{}\Tab{20}{\K{if}_(\V{state}.\V{dog}(\V{i}).\V{d}.\V{x}_\<_\N{0})_\{\V{state}.\V{dog}(\V{i}).\V{d}.\V{x}_*=_\V{mul};\}}}
\L{\LB{}\Tab{20}{\K{if}_(\V{state}.\V{dog}(\V{i}).\V{d}.\V{y}_\<_\N{0})_\{\V{state}.\V{dog}(\V{i}).\V{d}.\V{y}_*=_\V{mul};\}_\}}}
\L{\LB{}\Tab{16}{\K{if}_(\V{a}_\<=_\N{0.0f}_\&\&_\V{b}_\>=_\N{0.0f})_\{_}}
\L{\LB{}\Tab{20}{\K{if}_(\V{state}.\V{dog}(\V{i}).\V{d}.\V{x}_\<_\N{0})_\{\V{state}.\V{dog}(\V{i}).\V{d}.\V{x}_*=_\V{mul};\}}}
\L{\LB{}\Tab{20}{\K{if}_(\V{state}.\V{dog}(\V{i}).\V{d}.\V{y}_\>_\N{0})_\{\V{state}.\V{dog}(\V{i}).\V{d}.\V{y}_*=_\V{mul};\}_\}}}
\L{\LB{}\Tab{12}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\}}}
\index{postUpdate}\Proc{postUpdate}\L{\LB{}\Tab{4}{\K{void}_\V{postUpdate}()_\{\}}}
\L{\LB{}}
\L{\LB{\}}}
\L{\LB{}}
