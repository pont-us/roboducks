% Remember to use the lgrind style

\Head{}
\File{code/ducksim/DogContInt1.java}{2001}{5}{6}{14:06}{1659}
\L{\LB{\K{package}_\V{ducksim};}}
\L{\LB{\K{import}_\V{neurotic}.*;}}
\L{\LB{}}
\L{\LB{\K{class}_\V{DogContInt1}_\K{implements}_\V{DogBreeder}.\V{ControlInterface}_\{}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\V{DogControl}_\V{dogCont};}}
\L{\LB{}\Tab{2}{\V{TrainerControl}_\V{trainCont};}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{float}_\V{PI}_=_(\K{float})_\V{Math}.\V{PI};}}
\L{\LB{}\Tab{2}{\K{final}_\K{static}_\K{int}_\V{inputs}_=_\N{5};}}
\L{\LB{}}
\index{DogContInt1}\Proc{DogContInt1}\L{\LB{}\Tab{2}{\V{DogContInt1}(\V{DogControl}_\V{dogCont},_\V{TrainerControl}_\V{trainCont})_\{}}
\L{\LB{}\Tab{4}{\K{this}.\V{dogCont}_=_\V{dogCont};}}
\L{\LB{}\Tab{4}{\K{this}.\V{trainCont}_=_\V{trainCont};}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\index{inputs}\Proc{inputs}\L{\LB{}\Tab{2}{\K{public}_\K{int}_\V{inputs}()_\{_\K{return}_\V{inputs};_\}}}
\L{\LB{}}
\index{update}\Proc{update}\L{\LB{}\Tab{2}{\K{public}_\K{void}_\V{update}(\V{Net}_\V{net},_\V{DogControl}_\V{control})_\{}}
\L{\LB{}\Tab{4}{\V{Pos}_\V{dogPos}_=_\V{control}.\V{dog}(\N{0});}}
\L{\LB{}\Tab{4}{\V{Vec}_\V{wall}_=_\V{wallPoint}(\V{dogPos}.\V{p});}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\C{}//_net.setIn(0,_normAngle(dogPos.d.angle()));_//_dog_angle\CE{}}}
\L{\LB{}\Tab{4}{\C{}//_net.setIn(1,_normAngle(dogPos.p.angleTo(wall)));\CE{}}}
\L{\LB{}\Tab{4}{\V{net}.\V{setIn}(\N{0},_\V{normAngle}(\V{wall}.\V{angle}()_\-_\V{dogPos}.\V{d}.\V{angle}()));}}
\L{\LB{}\Tab{4}{\V{net}.\V{setIn}(\N{1},_\V{dogPos}.\V{p}.\V{distTo}(\V{wall})_/_\V{control}.\V{arenaSize}());}}
\L{\LB{}\Tab{4}{\V{net}.\V{setIn}(\N{2},_\V{normAngle}(_\V{dogPos}.\V{p}.\V{angleTo}(\V{control}.\V{flockCentre}())}}
\L{\LB{}\Tab{28}{\-_\V{dogPos}.\V{d}.\V{angle}()));}}
\L{\LB{}\Tab{4}{\V{net}.\V{setIn}(\N{3},_\V{dogPos}.\V{p}.\V{distTo}(\V{control}.\V{flockCentre}())_/_\V{control}.\V{arenaSize}());}}
\L{\LB{}\Tab{4}{\V{net}.\V{setIn}(\N{4},_\N{2}_*_\V{control}.\V{flockRadius}()_/_\V{control}.\V{arenaSize}());}}
\L{\LB{}\Tab{4}{\V{net}.\V{think}();}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\K{float}_\V{theta}_=_\V{dogPos}.\V{d}.\V{angle}();}}
\L{\LB{}\Tab{4}{\K{float}_\V{r}_=_\V{dogPos}.\V{d}.\V{abs}();}}
\L{\LB{}\Tab{4}{\V{r}_=_\V{net}.\V{getOut}(\N{0})_*_\N{16};}}
\L{\LB{}\Tab{4}{\V{theta}_+=_\V{PI}_*_(\V{net}.\V{getOut}(\N{1})_\-_\N{0.5f});}}
\L{\LB{}\Tab{4}{\V{dogPos}.\V{d}.\V{x}_=_(\K{float})_(\V{r}_*_\V{Math}.\V{sin}(\V{theta}));}}
\L{\LB{}\Tab{4}{\V{dogPos}.\V{d}.\V{y}_=_(\K{float})_(\V{r}_*_\V{Math}.\V{cos}(\V{theta}));}}
\L{\LB{}\Tab{4}{\V{control}.\V{setDog}(\N{0},_\V{dogPos}.\V{d});}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\C{}//_map_angle_in_radians_onto_[0,1]\CE{}}}
\L{\LB{}\Tab{2}{\C{}//_-pi_\|-\!\>_0,_+pi_\|-\!\>_1,_values_outside_[-pi,pi]_wrap.\CE{}}}
\index{normAngle}\Proc{normAngle}\L{\LB{}\Tab{2}{\K{private}_\K{float}_\V{normAngle}(\K{float}_\V{theta})_\{}}
\L{\LB{}\Tab{4}{\K{float}_\V{out}_=_(_(\V{theta}_+_\V{PI})_/_(\N{2}*\V{PI})_)_\%_\N{1.0f};}}
\L{\LB{}\Tab{4}{\K{if}_(\V{out}\<\N{0})_\V{out}_+=_\N{1.0f};}}
\L{\LB{}\Tab{4}{\K{return}_\V{out};}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\index{wallPoint}\Proc{wallPoint}\L{\LB{}\Tab{2}{\V{Vec}_\V{wallPoint}(\V{Vec}_\V{v})_\{}}
\L{\LB{}\Tab{4}{\C{}//_this_is_pretty_easy_if_the_arena{'}s_circular\CE{}}}
\L{\LB{}\Tab{4}{\K{return}_\V{v}.\V{unit}().\V{ti}(\V{trainCont}.\V{arenaSize}()).\V{mi}(\V{v});}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\L{\LB{\}}}
