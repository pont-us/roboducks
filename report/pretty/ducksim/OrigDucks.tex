% Remember to use the lgrind style

\Head{}
\File{code/ducksim/OrigDucks.java}{2001}{3}{28}{16:05}{2508}
\L{\LB{\K{package}_\V{ducksim};}}
\L{\LB{}}
\L{\LB{\K{public}_\K{class}_\V{OrigDucks}_\K{extends}_\V{AnimalModel}_\{}}
\L{\LB{}\Tab{4}{}}
\L{\LB{}\Tab{4}{\K{float}_\V{K1},_\V{K2},_\V{K3},_\V{K4},_\V{L};}}
\L{\LB{}\Tab{4}{\K{float}_\V{DUCKRADIUS},_\V{ARENASIZE},_\V{ARENAAREA};}}
\L{\LB{}\Tab{4}{\K{int}_\V{nFlockRadius};}}
\L{\LB{}\Tab{4}{\V{DuckControl}_\V{state};}}
\L{\LB{}}
\index{OrigDucks}\Proc{OrigDucks}\L{\LB{}\Tab{4}{\V{OrigDucks}(\V{DuckControl}_\V{state})_\{}}
\L{\LB{}\Tab{8}{\K{this}.\V{state}_=_\V{state};}}
\L{\LB{}\Tab{8}{\K{this}.\V{ARENASIZE}_=_\V{state}.\V{arenaSize}();}}
\L{\LB{}\Tab{8}{\V{ARENAAREA}_=_\V{ARENASIZE}_*_\V{ARENASIZE};}}
\L{\LB{}\Tab{8}{\V{K1}_=_\V{ARENAAREA}/\N{10};}}
\L{\LB{}\Tab{8}{\V{K2}_=_\V{ARENAAREA}/\N{100};}}
\L{\LB{}\Tab{8}{\V{K3}_=_\V{ARENAAREA}/\N{100};}}
\L{\LB{}\Tab{8}{\V{K4}_=_\V{ARENAAREA}/\N{10};}}
\L{\LB{}\Tab{8}{\V{L}_=_\V{ARENASIZE}/\N{4};}}
\L{\LB{}\Tab{8}{\V{DUCKRADIUS}_=_\V{ARENASIZE}/\N{22};}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}}
\index{update}\Proc{update}\L{\LB{}\Tab{4}{\K{void}_\V{update}()_\{}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\C{}//_Vec_vArenaCentre_=_new_Vec(ARENASIZE/2,ARENASIZE/2);\CE{}}}
\L{\LB{}\Tab{8}{\V{Vec}_\V{vArenaCentre}_=_\K{new}_\V{Vec}(\N{0},\N{0});}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{for}_(\K{int}_\V{i}_=_\N{0};_\V{i}_\<_\V{state}.\V{ducks}();_\V{i}++)_\{}}
\L{\LB{}\Tab{12}{\V{Vec}_\V{d}_=_\K{new}_\V{Vec}(\N{0},\N{0});_\C{}//_hope_this_is_right\CE{}}}
\L{\LB{}\Tab{12}{\V{Vec}_\V{W},_\V{D};}}
\L{\LB{}\Tab{12}{\K{float}_\V{nDist},_\V{nParam};}}
\L{\LB{}\Tab{12}{\V{D}_=_\V{state}.\V{duck}(\V{i}).\V{p};}}
\L{\LB{}\Tab{16}{}}
\L{\LB{}\Tab{12}{\C{}//_Apply_duck_control_algorithm\CE{}}}
\L{\LB{}}
\L{\LB{}\Tab{12}{\K{for}_(\K{int}_\V{j}_=_\N{0};_\V{j}_\<_\V{state}.\V{ducks}();_\V{j}++)_\{}}
\L{\LB{}\Tab{16}{\K{if}_(\V{j}==\V{i})_\K{continue};}}
\L{\LB{}\Tab{16}{\K{final}_\V{Vec}_\V{Dn}_=_\V{state}.\V{duck}(\V{j}).\V{p};}}
\L{\LB{}\Tab{16}{\V{nDist}_=_\V{Dn}.\V{mi}(\V{D}).\V{abs}();}}
\L{\LB{}\Tab{16}{\V{nParam}_=_\V{K1}_/_((\V{nDist}_+_\V{L})_*_(\V{nDist}_+_\V{L}))_\-_}}
\L{\LB{}\Tab{20}{\V{K2}_/_(\V{nDist}_*_\V{nDist});}}
\L{\LB{}\Tab{16}{\V{d}_=_\V{d}.\V{pl}(_\V{Dn}.\V{mi}(\V{D}).\V{unit}().\V{ti}(\V{nParam})_);}}
\L{\LB{}\Tab{12}{\}}}
\L{\LB{}\Tab{12}{\K{for}_(\K{int}_\V{j}_=_\N{0};_\V{j}_\<_\V{state}.\V{dogs}();_\V{j}++)_\{}}
\L{\LB{}\Tab{16}{\K{final}_\V{Vec}_\V{R}_=_\V{state}.\V{dog}(\V{j}).\V{p};}}
\L{\LB{}\Tab{16}{\V{nDist}_=_\V{R}.\V{mi}(\V{D}).\V{abs}();}}
\L{\LB{}\Tab{16}{\V{nParam}_=_\-\V{K4}_/_(\V{nDist}_*_\V{nDist});}}
\L{\LB{}\Tab{16}{\V{d}_=_\V{d}.\V{pl}(_\V{R}.\V{mi}(\V{D}).\V{unit}().\V{ti}(\V{nParam})_);}}
\L{\LB{}\Tab{12}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{12}{\C{}//_Find_nearest_point_on_wall\CE{}}}
\L{\LB{}\Tab{12}{\V{W}_=_\V{D}.\V{mi}(\V{vArenaCentre}).\V{unit}().\V{ti}(\V{ARENASIZE}/\N{2}).\V{pl}(\V{vArenaCentre});}}
\L{\LB{}\Tab{12}{\V{nDist}_=_\V{W}.\V{mi}(\V{D}).\V{abs}();}}
\L{\LB{}\Tab{12}{\V{nParam}_=_\-\V{K3}_/_(\V{nDist}_*_\V{nDist});}}
\L{\LB{}\Tab{12}{\V{d}_=_\V{d}.\V{pl}(_\V{W}.\V{mi}(\V{D}).\V{unit}().\V{ti}(\V{nParam})_);}}
\L{\LB{}\Tab{12}{\V{state}.\V{setDuck}(\V{i},\V{d});}}
\L{\LB{}}
\L{\LB{}\Tab{12}{\C{}//_Matt{'}s_updated_angle_code_in_floats_and_radians\CE{}}}
\L{\LB{}\Tab{12}{\C{}//_scope_for_optimisation_here_but_not_going_into_it_yet\CE{}}}
\L{\LB{}}
\L{\LB{}\Tab{12}{\K{float}_\V{theta}_=_(\K{float})_\V{Math}.\V{atan}(\V{d}.\V{x}_/\V{d}.\V{y});_\C{}//_note_sign_change!!\CE{}}}
\L{\LB{}\Tab{12}{\K{if}_(\V{d}.\V{x}_\>_\N{0}_\&\&_\V{d}.\V{y}_\>\N{0})_}}
\L{\LB{}\Tab{16}{\{_\V{state}.\V{duck}(\V{i}).\V{nAngle}_=_\V{theta};\}}}
\L{\LB{}\Tab{12}{\K{else}_\K{if}_(\V{d}.\V{x}_\>_\N{0}_\&\&_\V{d}.\V{y}_\<_\N{0})_}}
\L{\LB{}\Tab{16}{\{_\V{state}.\V{duck}(\V{i}).\V{nAngle}_=_(\K{float})_\V{Math}.\V{PI}_+_\V{theta};\}}}
\L{\LB{}\Tab{12}{\K{else}_\K{if}_(\V{d}.\V{x}_\<_\N{0}_\&\&_\V{d}.\V{y}_\<_\N{0})_}}
\L{\LB{}\Tab{16}{\{_\V{state}.\V{duck}(\V{i}).\V{nAngle}_=_(\K{float})_\V{Math}.\V{PI}_+_\V{theta};\}}}
\L{\LB{}\Tab{12}{\K{else}_\K{if}_(\V{d}.\V{x}_\<_\N{0}_\&\&_\V{d}.\V{y}_\>_\N{0})}}
\L{\LB{}\Tab{16}{\{_\V{state}.\V{duck}(\V{i}).\V{nAngle}_=_(\K{float})_\V{Math}.\V{PI}*\N{2}_+_\V{theta};\}}}
\L{\LB{}\Tab{12}{\K{else}_\K{if}_(\V{d}.\V{x}_==_\N{0})}}
\L{\LB{}\Tab{16}{\K{if}_(\V{d}.\V{y}_\>=_\N{0})_\{_\V{state}.\V{duck}(\V{i}).\V{nAngle}_=_\N{0.0f};\}}}
\L{\LB{}\Tab{16}{\K{else}_\{_\V{state}.\V{duck}(\V{i}).\V{nAngle}_=_\N{2}_*_(\K{float})_\V{Math}.\V{PI};\}}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\}}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}}
\index{postUpdate}\Proc{postUpdate}\L{\LB{}\Tab{4}{\K{void}_\V{postUpdate}()_\{}}
\L{\LB{}\Tab{8}{\C{}//_calculate_flock_centre_and_radius\CE{}}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\V{Vec}_\V{F}_=_\K{new}_\V{Vec}(\N{0},\N{0});}}
\L{\LB{}\Tab{8}{\K{for}_(\K{int}_\V{i}_=_\N{0};_\V{i}_\<_\V{state}.\V{ducks}();_\V{i}++)}}
\L{\LB{}\Tab{12}{\V{F}_=_\V{F}.\V{pl}(\V{state}.\V{duck}(\V{i}).\V{p});}}
\L{\LB{}\Tab{8}{\V{F}_=_\V{F}.\V{ti}(\N{1}/\V{state}.\V{ducks}());}}
\L{\LB{}\Tab{8}{\V{nFlockRadius}_=_\N{0};}}
\L{\LB{}\Tab{8}{\K{for}_(\K{int}_\V{i}_=_\N{0};_\V{i}_\<_\V{state}.\V{ducks}();_\V{i}++)}}
\L{\LB{}\Tab{12}{\{}}
\L{\LB{}\Tab{16}{\K{int}_\V{nDist}_=_(\K{int})_\V{F}.\V{mi}(\V{state}.\V{duck}(\V{i}).\V{p}).\V{abs}();}}
\L{\LB{}\Tab{16}{\V{nFlockRadius}_=_\V{nFlockRadius}\>=\V{nDist}_?_\V{nFlockRadius}_\V{:}_\V{nDist};}}
\L{\LB{}\Tab{12}{\}}}
\L{\LB{}\Tab{8}{\V{nFlockRadius}_+=_\V{DUCKRADIUS};}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}}
\L{\LB{\}}}
\L{\LB{}}
