% Remember to use the lgrind style

\Head{}
\File{code/ducksim/ArenaView.java}{2001}{5}{18}{8:38}{4283}
\L{\LB{\C{}//_ArenaView:_view_class_for_Arena.\CE{}}}
\L{\LB{}}
\L{\LB{\K{package}_\V{ducksim};}}
\L{\LB{}}
\L{\LB{\K{import}_\V{java}.\V{awt}.*;}}
\L{\LB{\K{import}_\V{java}.\V{awt}.\V{event}.*;}}
\L{\LB{\K{import}_\V{javax}.\V{swing}.*;}}
\L{\LB{\K{import}_\V{java}.\V{awt}.\V{geom}.*;}}
\L{\LB{\K{import}_\V{java}.\V{awt}.\V{font}.*;}}
\L{\LB{}}
\L{\LB{\K{class}_\V{ArenaView}_\K{extends}_\V{JFrame}_\{}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\V{ArenaPanel}_\V{p};}\Tab{32}{\C{}//_the_actual_arena_display\CE{}}}
\L{\LB{}\Tab{2}{\K{private}_\K{boolean}_\V{active};}\Tab{32}{\C{}//_whether_we_should_be_updating\CE{}}}
\L{\LB{}\Tab{2}{\K{static}_\K{boolean}_\V{trace}_=_\K{true};}}
\L{\LB{}}
\index{ArenaView}\Proc{ArenaView}\L{\LB{}\Tab{2}{\K{public}_\V{ArenaView}(\V{Arena}_\V{a})_\{}}
\L{\LB{}\Tab{4}{\K{super}(\S{}\3Duck_Display\3\SE{});}}
\L{\LB{}\Tab{4}{\V{active}_=_\K{true};}}
\L{\LB{}\Tab{4}{\V{p}_=_\K{new}_\V{ArenaPanel}(\V{a});}}
\L{\LB{}\Tab{4}{\V{setContentPane}(\V{p});}}
\L{\LB{}\Tab{4}{\V{p}.\V{reset}();}}
\L{\LB{}\Tab{4}{\V{pack}();}}
\L{\LB{}\Tab{4}{\V{show}();}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\index{setActive}\Proc{setActive}\L{\LB{}\Tab{2}{\K{public}_\K{void}_\V{setActive}(\K{boolean}_\V{a})_\{_\V{active}_=_\V{a};_\V{repaint}();_\}}}
\index{isActive}\Proc{isActive}\L{\LB{}\Tab{2}{\K{public}_\K{boolean}_\V{isActive}()_\{_\K{return}_\V{active};_\}}}
\index{reset}\Proc{reset}\L{\LB{}\Tab{2}{\K{public}_\K{void}_\V{reset}()_\{_\V{p}.\V{reset}();_\}}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\K{class}_\V{ArenaPanel}_\K{extends}_\V{JPanel}_\{}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\C{}//_whether_to_produce_a_trace_of_the_dog{'}s_motion\CE{}}}
\L{\LB{}\Tab{4}{\V{GeneralPath}_\V{tracePath};}}
\L{\LB{}\Tab{4}{\V{Arena}_\V{arena};}}
\L{\LB{}\Tab{4}{\V{Font}_\V{f}_=_\K{new}_\V{Font}(\S{}\3SansSerif\3\SE{},\V{Font}.\V{PLAIN},\N{14});}}
\L{\LB{}\Tab{4}{\K{int}_\V{nextPathUpdate};}}
\L{\LB{}}
\index{ArenaPanel}\Proc{ArenaPanel}\L{\LB{}\Tab{4}{\V{ArenaPanel}(\V{Arena}_\V{a})_\{}}
\L{\LB{}\Tab{6}{\K{super}();}}
\L{\LB{}\Tab{6}{\V{arena}_=_\V{a};}}
\L{\LB{}\Tab{6}{\V{setSize}(\N{256},_\N{256});}}
\L{\LB{}\Tab{6}{\V{setPreferredSize}(\K{new}_\V{Dimension}(\N{256},_\N{256}));}}
\L{\LB{}\Tab{6}{\V{tracePath}_=_\V{trace}_?_\K{new}_\V{GeneralPath}(\N{0},_\N{1000})_\V{:}_\K{null};}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}}
\index{reset}\Proc{reset}\L{\LB{}\Tab{4}{\K{public}_\K{void}_\V{reset}()_\{}}
\L{\LB{}\Tab{6}{\V{tracePath}.\V{reset}();}}
\L{\LB{}\Tab{6}{\V{nextPathUpdate}_=_\N{0};}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}}
\index{paintComponent}\Proc{paintComponent}\L{\LB{}\Tab{4}{\K{public}_\K{void}_\V{paintComponent}(\V{Graphics}_\V{oldGraphics})_\{}}
\L{\LB{}\Tab{6}{\V{Graphics2D}_\V{g}_=_(\V{Graphics2D})_\V{oldGraphics};}}
\L{\LB{}\Tab{6}{\K{int}_\V{size}_=_\V{getWidth}()\<\V{getHeight}()_?_\V{getWidth}()_\V{:}_\V{getHeight}();}}
\L{\LB{}\Tab{6}{\K{int}_\V{centre}_=_\V{size}/\N{2};}}
\L{\LB{}\Tab{6}{\K{int}_\V{radius}_=_\V{centre};}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{g}.\V{setRenderingHint}(\V{RenderingHints}.\V{KEY\_ANTIALIASING},}}
\L{\LB{}\Tab{25}{\V{RenderingHints}.\V{VALUE\_ANTIALIAS\_ON});}}
\L{\LB{}\Tab{6}{\V{clear}(\V{g});}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{g}.\V{setColor}(\V{Color}.\V{black});}}
\L{\LB{}\Tab{6}{\V{g}.\V{setFont}(\V{f});}}
\L{\LB{}\Tab{6}{\V{g}.\V{setStroke}(\K{new}_\V{BasicStroke}(\N{4}));}}
\L{\LB{}\Tab{6}{\V{g}.\V{draw}(\K{new}_\V{Ellipse2D}.\V{Float}(\N{2},\N{2},\V{size}\-\N{4},\V{size}\-\N{4}));}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\K{if}_(\V{active})_\{}}
\L{\LB{}\Tab{8}{\K{if}_(\V{trace})_\{}}
\L{\LB{}\Tab{10}{\K{final}_\K{float}_\V{x}_=_\V{arena}.\V{dogPos}(\N{0}).\V{x};}}
\L{\LB{}\Tab{10}{\K{final}_\K{float}_\V{y}_=_\V{arena}.\V{dogPos}(\N{0}).\V{y};}}
\L{\LB{}\Tab{10}{\V{g}.\V{setColor}(\V{Color}.\V{darkGray});}}
\L{\LB{}\Tab{10}{\V{g}.\V{setStroke}(\K{new}_\V{BasicStroke}(\N{1}));}}
\L{\LB{}\Tab{10}{\K{if}_(\V{arena}.\V{time}()\>=\V{nextPathUpdate})_\{}}
\L{\LB{}\Tab{12}{\K{if}_(\V{nextPathUpdate}==\N{0})_\V{tracePath}.\V{moveTo}(\V{x},\V{y});}}
\L{\LB{}\Tab{12}{\K{else}_\V{tracePath}.\V{lineTo}(\V{x},\V{y});}}
\L{\LB{}\Tab{12}{\V{nextPathUpdate}_+=_\N{10};}}
\L{\LB{}\Tab{10}{\}}}
\L{\LB{}\Tab{10}{\V{AffineTransform}_\V{a}_=_\K{new}_\V{AffineTransform}();}}
\L{\LB{}\Tab{10}{\V{a}.\V{translate}(\V{centre},_\V{centre});}}
\L{\LB{}\Tab{10}{\V{a}.\V{scale}(\V{radius}/\V{arena}.\V{arenaSize}(),_\V{radius}/\V{arena}.\V{arenaSize}());}}
\L{\LB{}\Tab{10}{\V{g}.\V{draw}(\V{tracePath}.\V{createTransformedShape}(\V{a}));}}
\L{\LB{}\Tab{8}{\}}}
\L{\LB{}\Tab{8}{\K{for}_(\K{int}_\V{i}=\N{0};_\V{i}\<\V{arena}.\V{ducks}();_\V{i}++)}}
\L{\LB{}\Tab{10}{\V{drawDuck}(\V{size},_\V{g},_\V{arena}.\V{duck}(\V{i}));}}
\L{\LB{}\Tab{8}{\K{for}_(\K{int}_\V{i}=\N{0};_\V{i}\<\V{arena}.\V{dogs}();_\V{i}++)}}
\L{\LB{}\Tab{10}{\V{drawDog}(\V{size},_\V{g},_\V{arena}.\V{dog}(\V{i}));}}
\L{\LB{}\Tab{8}{\V{g}.\V{setColor}(\V{Color}.\V{black});}}
\L{\LB{}\Tab{8}{\V{g}.\V{drawString}(\V{String}.\V{valueOf}(\V{arena}.\V{time}()),_\N{4},_\N{16});}}
\L{\LB{}\Tab{6}{\}_\K{else}_\{}}
\L{\LB{}\Tab{8}{\V{drawText}(\V{g},_\S{}\3Display_inactive\3\SE{});}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}}
\index{drawText}\Proc{drawText}\L{\LB{}\Tab{4}{\K{private}_\K{void}_\V{drawText}(\V{Graphics2D}_\V{g},_\V{String}_\V{text})_\{}}
\L{\LB{}\Tab{6}{\V{Rectangle2D}_\V{box}_=_\V{getBounds}();}}
\L{\LB{}\Tab{6}{\V{FontRenderContext}_\V{frc}_=_\V{g}.\V{getFontRenderContext}();}}
\L{\LB{}\Tab{6}{\V{Rectangle2D}_\V{bounds}_=_\V{f}.\V{getStringBounds}(\V{text},\V{frc});}}
\L{\LB{}\Tab{6}{\V{LineMetrics}_\V{metrics}_=_\V{f}.\V{getLineMetrics}(\V{text},\V{frc});}}
\L{\LB{}\Tab{6}{\K{float}_\V{width}_=_(\K{float})_\V{bounds}.\V{getWidth}();}}
\L{\LB{}\Tab{6}{\K{float}_\V{lineheight}_=_\V{metrics}.\V{getHeight}();}}
\L{\LB{}\Tab{6}{\K{float}_\V{ascent}_=_\V{metrics}.\V{getAscent}();}}
\L{\LB{}\Tab{6}{\K{float}_\V{x0}_=_(\K{float})_(\V{box}.\V{getX}()_+_(\V{box}.\V{getWidth}()_\-_\V{width})/\N{2});}}
\L{\LB{}\Tab{6}{\K{float}_\V{y0}_=_(\K{float})_(\V{box}.\V{getY}()_+_(\V{box}.\V{getHeight}()_\-_\V{lineheight})/\N{2}}}
\L{\LB{}\Tab{26}{+_\V{ascent});}}
\L{\LB{}\Tab{6}{\V{g}.\V{drawString}(\V{text},_\V{x0},_\V{y0});}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}}
\index{drawDog}\Proc{drawDog}\L{\LB{}\Tab{4}{\K{private}_\K{void}_\V{drawDog}(\K{int}_\V{size},_\V{Graphics2D}_\V{g},_\V{Pos}_\V{p})_\{}}
\L{\LB{}\Tab{6}{\K{final}_\K{float}_\V{r}_=_\V{size}_/_\N{50};}}
\L{\LB{}\Tab{6}{\K{final}_\K{float}_\V{x}_=_(\V{size}/\N{2})_+_\V{p}.\V{p}.\V{x}_*_(\V{size}/\N{2})_/_\V{arena}.\V{arenaSize}();}}
\L{\LB{}\Tab{6}{\K{final}_\K{float}_\V{y}_=_(\V{size}/\N{2})_+_\V{p}.\V{p}.\V{y}_*_(\V{size}/\N{2})_/_\V{arena}.\V{arenaSize}();}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{g}.\V{setColor}(\V{Color}.\V{black});}}
\L{\LB{}\Tab{6}{\V{g}.\V{setStroke}(\K{new}_\V{BasicStroke}(\N{4}));}}
\L{\LB{}\Tab{6}{\V{g}.\V{draw}(\K{new}_\V{Ellipse2D}.\V{Float}(\V{x}\-\V{r},_\V{y}\-\V{r},_\N{2}*\V{r},_\N{2}*\V{r}));}}
\L{\LB{}\Tab{6}{\V{g}.\V{setColor}(\V{Color}.\V{red});}}
\L{\LB{}\Tab{6}{\V{g}.\V{setStroke}(\K{new}_\V{BasicStroke}(\N{1}));}}
\L{\LB{}\Tab{6}{\V{g}.\V{draw}(\K{new}_\V{Line2D}.\V{Float}(\V{x},_\V{y},}}
\L{\LB{}\Tab{30}{\V{x}+_\V{r}*\V{p}.\V{d}.\V{x}_*_\N{2f},}}
\L{\LB{}\Tab{30}{\V{y}_+_\V{r}*\V{p}.\V{d}.\V{y}_*_\N{2f}_));}}
\L{\LB{}\Tab{6}{}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}}
\index{drawDuck}\Proc{drawDuck}\L{\LB{}\Tab{4}{\K{private}_\K{void}_\V{drawDuck}(\K{int}_\V{size},_\V{Graphics2D}_\V{g},_\V{Pos}_\V{p})_\{}}
\L{\LB{}\Tab{6}{\K{final}_\K{float}_\V{r}_=_\V{size}_/_\N{60};}}
\L{\LB{}\Tab{6}{\K{final}_\K{float}_\V{x}_=_(\V{size}/\N{2})_+_\V{p}.\V{p}.\V{x}_*_(\V{size}/\N{2})_/_\V{arena}.\V{arenaSize}();}}
\L{\LB{}\Tab{6}{\K{final}_\K{float}_\V{y}_=_(\V{size}/\N{2})_+_\V{p}.\V{p}.\V{y}_*_(\V{size}/\N{2})_/_\V{arena}.\V{arenaSize}();}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{g}.\V{setColor}(\V{Color}.\V{blue});}}
\L{\LB{}\Tab{6}{\V{g}.\V{setStroke}(\K{new}_\V{BasicStroke}(\N{2}));}}
\L{\LB{}\Tab{6}{\V{g}.\V{draw}(\K{new}_\V{Ellipse2D}.\V{Float}(\V{x}\-\V{r},_\V{y}\-\V{r},_\N{2}*\V{r},_\N{2}*\V{r}));}}
\L{\LB{}\Tab{6}{\V{g}.\V{setColor}(\V{Color}.\V{red});}}
\L{\LB{}\Tab{6}{\V{g}.\V{setStroke}(\K{new}_\V{BasicStroke}(\N{1}));}}
\L{\LB{}\Tab{6}{\V{g}.\V{draw}(\K{new}_\V{Line2D}.\V{Float}(\V{x},_\V{y},}}
\L{\LB{}\Tab{30}{\V{x}+_\V{r}*\V{p}.\V{d}.\V{x}*\N{2},}}
\L{\LB{}\Tab{30}{\V{y}_+_\V{r}*\V{p}.\V{d}.\V{y}*\N{2}));}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\C{}//_super.paintComponent_clears_offscreen_pixmap,\CE{}}}
\L{\LB{}\Tab{4}{\C{}//_since_we{'}re_using_double_buffering_by_default.\CE{}}}
\index{clear}\Proc{clear}\L{\LB{}\Tab{4}{\K{protected}_\K{void}_\V{clear}(\V{Graphics}_\V{g})_\{}}
\L{\LB{}\Tab{6}{\K{super}.\V{paintComponent}(\V{g});}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\L{\LB{\}}}
